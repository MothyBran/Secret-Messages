<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SECURE MESSENGER | Enterprise Edition</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <style>
        :root {
            --bg-dark: #050505;
            --bg-panel: #0f1215;
            --accent-blue: #00BFFF;
            --accent-glow: rgba(0, 191, 255, 0.3);
            --text-main: #e0e0e0;
            --text-muted: #8899a6;
            --border-color: #333;
            --error-red: #ff3333;
            --success-green: #00ff41;
            
            --sidebar-width: 280px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            height: 100vh;
            overflow: hidden; /* App-Feeling */
            display: flex;
            flex-direction: column;
        }

        /* GRID BACKGROUND */
        .bg-grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 191, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(0, 191, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            z-index: -1; pointer-events: none;
        }

        /* HEADER */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: rgba(15, 18, 21, 0.95);
            border-bottom: 1px solid var(--border-color);
            z-index: 100; backdrop-filter: blur(10px);
            flex-shrink: 0;
        }
        .logo { font-size: 1.4rem; font-weight: 700; letter-spacing: 2px; color: #fff; text-shadow: 0 0 10px var(--accent-glow); }
        .logo span { color: var(--accent-blue); }

        .menu-btn { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }

        /* SIDEBAR */
        .sidebar {
            position: fixed; top: 0; right: calc(-1 * var(--sidebar-width)); width: var(--sidebar-width); height: 100%;
            background: var(--bg-panel); border-left: 1px solid var(--accent-blue);
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 200;
            padding: 20px; display: flex; flex-direction: column;
            box-shadow: -10px 0 30px rgba(0,0,0,0.8);
        }
        .sidebar.active { right: 0; }
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 150;
            display: none; backdrop-filter: blur(3px);
        }
        .sidebar-overlay.active { display: block; }
        
        .sidebar h3 { color: var(--accent-blue); margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .sidebar-item { padding: 12px 0; border-bottom: 1px solid #222; color: #ccc; text-decoration: none; display: flex; align-items: center; gap: 10px; transition: 0.2s; cursor: pointer; }
        .sidebar-item:hover { color: var(--accent-blue); padding-left: 5px; }
        .user-info { margin-bottom: 20px; font-family: 'Roboto Mono'; font-size: 0.8rem; color: #666; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px; }

        /* SCROLLABLE MAIN CONTENT */
        .main-scroll-area {
            flex: 1; overflow-y: auto; overflow-x: hidden;
            padding: 20px; display: flex; justify-content: center;
        }
        .container { width: 100%; max-width: 500px; padding-bottom: 40px; }

        .section { display: none; animation: fadeIn 0.3s ease-out; }
        .section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* INPUTS & BUTTONS */
        .input-group { margin-bottom: 15px; }
        .input-label { display: block; margin-bottom: 6px; font-size: 0.75rem; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 1px; }
        
        .input-field {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color);
            padding: 12px; color: #fff; font-family: 'Roboto Mono', monospace; font-size: 0.95rem;
            border-radius: 4px; transition: 0.3s;
        }
        .input-field:focus { border-color: var(--accent-blue); outline: none; box-shadow: 0 0 10px var(--accent-glow); }
        textarea.input-field { resize: vertical; min-height: 80px; }

        .btn {
            width: 100%; padding: 12px; background: rgba(0, 191, 255, 0.05); border: 1px solid var(--accent-blue);
            color: var(--accent-blue); font-weight: bold; cursor: pointer; text-transform: uppercase;
            letter-spacing: 2px; transition: 0.2s; margin-top: 5px; font-family: 'Rajdhani', sans-serif;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .btn:hover:not(:disabled) { background: var(--accent-blue); color: #000; box-shadow: 0 0 15px var(--accent-glow); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; border-color: #555; color: #888; }
        .btn-danger { border-color: var(--error-red); color: var(--error-red); background: rgba(255, 50, 50, 0.05); }
        .btn-danger:hover { background: var(--error-red); color: #fff; }

        /* TOGGLE SWITCH (SLIDER) */
        .switch-wrapper {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; border: 1px solid #222; margin-bottom: 20px;
        }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 30px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-blue); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* MODALS */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal.active { display: flex; }
        .modal-content { background: var(--bg-panel); border: 1px solid var(--accent-blue); padding: 25px; width: 90%; max-width: 450px; position: relative; max-height: 85vh; overflow-y: auto; }

        /* TABS */
        .tabs { display: flex; border-bottom: 1px solid #333; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; background: none; border: none; color: #666; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* CONTACT LIST */
        ul.contact-list { list-style: none; max-height: 200px; overflow-y: auto; margin-top: 10px; }
        ul.contact-list li { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #222; font-size: 0.9rem; }
        ul.contact-list li:hover { background: rgba(255,255,255,0.02); }

    </style>
</head>
<body>

    <div class="bg-grid"></div>

    <header>
        <div class="logo">SECURE<span>MSG</span></div>
        <button class="menu-btn" id="menuToggle">‚ò∞</button>
    </header>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar" id="sidebar">
        <h3>MEN√ú</h3>
        
        <div class="user-info">
            <div id="sidebarUser" style="color:#fff; font-weight:bold; margin-bottom:5px;">Gast</div>
            <div id="sidebarLicense" style="font-size:0.75rem; color:var(--accent-blue);">Nicht verbunden</div>
        </div>

        <div class="auth-only" style="display:none; flex-direction:column;">
            <a href="#" class="sidebar-item" id="navMain">üè† Hauptansicht</a>
            <a href="#" class="sidebar-item" id="navContacts">üìá Kontaktverzeichnis</a>
            <a href="#" class="sidebar-item" id="navGuide">üìñ Anleitung</a>
            <a href="#" class="sidebar-item" id="navInfo">‚ÑπÔ∏è Info & Sicherheit</a>
            
            <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
                <a href="#" class="sidebar-item" id="navDelete" style="color:var(--error-red);">‚ö†Ô∏è Account l√∂schen</a>
                <a href="#" class="sidebar-item" id="logoutBtnSide">üîí Abmelden</a>
            </div>
        </div>
        
        <div style="margin-top:auto; font-size:0.7rem; color:#444;">
            v3.0.0 ENTERPRISE<br>AES-GCM ENCRYPTED
        </div>
    </div>

    <div class="main-scroll-area">
        <div class="container">

            <div id="loginSection" class="section active">
                <h2 style="text-align:center; margin-bottom:20px; color:#fff;">IDENTIFIZIERUNG</h2>
                <form id="loginForm">
                    <div class="input-group">
                        <label class="input-label">Benutzername</label>
                        <input type="text" id="username" class="input-field" placeholder="USER.ID" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Zugangscode</label>
                        <input type="password" id="accessCode" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="5" inputmode="numeric" required style="letter-spacing:5px; text-align:center;">
                    </div>
                    <button type="submit" class="btn">VERBINDUNG HERSTELLEN</button>
                </form>
                <div style="text-align:center; margin-top:20px;">
                    <a href="#" id="showActivationLink" style="color:#666; font-size:0.8rem; text-decoration:none;">Lizenzschl√ºssel aktivieren</a>
                </div>
            </div>

            <div id="activationSection" class="section">
                <h2 style="text-align:center; margin-bottom:20px;">NEUES KONTO</h2>
                <form id="activationForm">
                    <div class="input-group">
                        <label class="input-label">Lizenz-Schl√ºssel</label>
                        <input type="text" id="licenseKey" class="input-field" placeholder="XXXX-XXXX-XXXX-XXXX" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Gew√ºnschter Benutzername</label>
                        <input type="text" id="newUsername" class="input-field" required>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Neuer Zugangscode (5 Zahlen)</label>
                        <input type="text" id="newAccessCode" class="input-field" maxlength="5" inputmode="numeric" required style="letter-spacing:5px; text-align:center;">
                    </div>
                    <button type="submit" class="btn">KONTO ERSTELLEN</button>
                    <button type="button" class="btn" id="showLoginLink" style="margin-top:10px; background:none; border:none; color:#666;">Zur√ºck</button>
                </form>
            </div>

            <div id="mainSection" class="section">
                
                <div class="switch-wrapper">
                    <span id="labelEncrypt" style="font-size:0.8rem; color:var(--accent-blue); font-weight:bold;">VERSCHL√úSSELN</span>
                    <label class="switch">
                        <input type="checkbox" id="modeSwitch">
                        <span class="slider"></span>
                    </label>
                    <span id="labelDecrypt" style="font-size:0.8rem; color:#444;">ENTSCHL√úSSELN</span>
                </div>

                <div class="input-group" id="recipientGroup">
                    <label class="input-label">Empf√§nger (Optional)</label>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="recipientName" class="input-field" placeholder="z.B. UserA, UserB">
                        <button class="btn" id="contactsBtn" style="width:50px; margin-top:0;" title="Kontakte">üìá</button>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">Geheim-Code (5 Zahlen)</label>
                    <input type="password" id="messageCode" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="5" inputmode="numeric" style="letter-spacing:5px; text-align:center;">
                </div>

                <div class="input-group">
                    <label class="input-label">Nachricht</label>
                    <textarea id="messageInput" class="input-field" rows="5" placeholder="Nachricht eingeben..."></textarea>
                </div>

                <button id="actionBtn" class="btn">üîí DATEN VERSCHL√úSSELN</button>
                
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button id="copyBtn" class="btn" style="flex:1;">üìã Kopieren</button>
                    <button id="clearFieldsBtn" class="btn btn-danger" style="flex:1;">üßπ Leeren</button>
                </div>
                <button id="qrGenBtn" class="btn" style="margin-top:10px; border-color:#fff; color:#fff;">üì± QR Code</button>

                <div class="input-group" id="outputGroup" style="display:none; margin-top:20px; padding-top:20px; border-top:1px dashed #333;">
                    <label class="input-label" style="color:var(--success-green);">ERGEBNIS</label>
                    <textarea id="messageOutput" class="input-field" rows="4" readonly style="color:var(--accent-blue); border-color:var(--accent-blue);"></textarea>
                </div>
            </div>

            <div id="renewalSection" class="section" style="text-align:center;">
                <div style="border:1px solid var(--error-red); padding:20px; background:rgba(255,0,0,0.05);">
                    <h2 style="color:var(--error-red); margin-bottom:10px;">LIZENZ ABGELAUFEN</h2>
                    <p style="color:#ccc; margin-bottom:20px;">Bitte verl√§ngern Sie Ihre Lizenz.</p>
                    <button class="btn" onclick="startRenewal('1m')">1 Monat (1,99‚Ç¨)</button>
                    <button class="btn" onclick="startRenewal('12m')">1 Jahr (14,99‚Ç¨)</button>
                    <button class="btn" style="margin-top:20px; border:none;" onclick="location.reload()">Abmelden</button>
                </div>
            </div>

            <div id="guideSection" class="section">
                <h3 style="color:var(--accent-blue); margin-bottom:15px;">ANLEITUNG</h3>
                <div style="font-size:0.9rem; line-height:1.6; color:#ccc;">
                    <p><b>1. Verschl√ºsseln:</b><br>
                    W√§hle oben den Schalter "Verschl√ºsseln". Gib deine Nachricht ein und w√§hle einen 5-stelligen Code. Dr√ºcke auf Verschl√ºsseln.</p>
                    <br>
                    <p><b>2. Entschl√ºsseln:</b><br>
                    Stelle den Schalter auf "Entschl√ºsseln". F√ºge den "Salat"-Text ein, gib den Code ein und dr√ºcke auf Entschl√ºsseln.</p>
                    <br>
                    <p><b>3. Sicherheit:</b><br>
                    Die Daten werden lokal in deinem Browser verarbeitet. Wir speichern keine Nachrichten.</p>
                </div>
                <button class="btn" onclick="document.getElementById('navMain').click()" style="margin-top:20px;">Zur√ºck</button>
            </div>

            <div id="infoSection" class="section">
                <h3 style="color:var(--accent-blue); margin-bottom:15px;">INFO & SICHERHEIT</h3>
                <div style="font-size:0.9rem; color:#888;">
                    <p>Version: 3.5.0 Enterprise</p>
                    <p>Verschl√ºsselung: AES-GCM (256-bit)</p>
                    <p>Key Derivation: PBKDF2 (100k rounds)</p>
                    <br>
                    <p>Dieses System wurde f√ºr maximale Sicherheit entwickelt. Ohne den 5-stelligen Code sind die Daten mathematisch nicht wiederherstellbar.</p>
                </div>
                <button class="btn" onclick="document.getElementById('navMain').click()" style="margin-top:20px;">Zur√ºck</button>
            </div>

        </div>
    </div>

    <div id="contactsModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--accent-blue); margin-bottom:15px; text-align:center;">KONTAKTE</h3>
            
            <div class="tabs">
                <button class="tab-btn active" data-target="tabSelect">Ausw√§hlen</button>
                <button class="tab-btn" data-target="tabManage">Verwalten</button>
            </div>

            <div id="tabSelect" class="tab-content active">
                <ul id="selectContactList" class="contact-list"></ul>
                <button id="confirmSelectionBtn" class="btn" style="margin-top:15px;">√úbernehmen</button>
            </div>

            <div id="tabManage" class="tab-content">
                <form id="addContactForm" style="display:flex; gap:5px; margin-bottom:10px;">
                    <input type="text" id="newContactName" class="input-field" placeholder="Name" style="flex:1;">
                    <input type="text" id="newContactID" class="input-field" placeholder="ID" style="flex:1;">
                    <button type="submit" class="btn" style="width:40px; margin-top:0;">+</button>
                </form>
                <ul id="contactList" class="contact-list"></ul>
            </div>
            
            <button class="btn" onclick="document.getElementById('contactsModal').classList.remove('active')" style="margin-top:10px; background:none; border:none; color:#666;">Schlie√üen</button>
        </div>
    </div>

    <div id="qrModal" class="modal">
        <div class="modal-content" style="text-align:center;">
            <h3>QR CODE</h3>
            <div id="qrDisplay" style="background:#fff; padding:10px; margin:20px auto; width:220px; height:220px; display:flex; justify-content:center; align-items:center;"></div>
            <button class="btn" onclick="document.getElementById('qrModal').classList.remove('active')">Schlie√üen</button>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
