<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Enterprise Admin Panel</title>
    <link href="/assets/fonts/fonts.css" rel="stylesheet">
    <link href="/assets/css/ui.css" rel="stylesheet">
    <!-- No external scripts/CDNs -->
</head>
<body>

    <!-- LOCK OVERLAY -->
    <div id="lockOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.95); z-index:9999; flex-direction:column; justify-content:center; align-items:center; backdrop-filter:blur(10px);">
        <h1 style="color:var(--error-red); text-shadow:0 0 20px red; margin-bottom:20px;">INTERFACE LOCKED</h1>
        <div style="width:300px; text-align:center;">
            <input type="password" id="unlockPass" placeholder="Enter Password to Unlock" style="width:100%; text-align:center; margin-bottom:10px;">
            <button class="action-btn" onclick="unlockInterface()" style="width:100%; background:var(--error-red); color:#fff;">UNLOCK</button>
            <div id="unlockMsg" style="margin-top:10px; color:red; min-height:20px;"></div>
        </div>
    </div>

    <!-- CREATE USER MODAL -->
    <div id="createUserModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:2000; align-items:center; justify-content:center;">
        <div class="stat-card" style="width:400px; background:#111; border:1px solid var(--accent-primary);">
            <h3>Create New User</h3>
            <div style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
                <input type="text" id="newUsername" placeholder="Username">
                <input type="text" id="newPassword" placeholder="Initial Password">
                <select id="newDept" style="background:#000; color:#fff; padding:10px; border:1px solid #444;">
                    <option value="Management">Management</option>
                    <option value="IT">IT</option>
                    <option value="HR">HR</option>
                    <option value="Sales">Sales</option>
                    <option value="Unassigned">Unassigned</option>
                </select>
                <input type="text" id="newRole" placeholder="Role Title (e.g. Analyst)">
                <button class="action-btn" onclick="submitCreateUser()">CREATE USER</button>
                <button class="action-btn" onclick="document.getElementById('createUserModal').style.display='none'" style="background:#333; color:#fff;">CANCEL</button>
            </div>
        </div>
    </div>

    <!-- CONTACT LIST OVERLAY -->
    <div id="contactOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.9); z-index:3000; align-items:center; justify-content:center;">
        <div class="stat-card" style="width:500px; height:600px; background:#111; border:1px solid var(--accent-primary); display:flex; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; padding-bottom:10px;">
                <h3>INTERNE KONTAKTE</h3>
                <button onclick="document.getElementById('contactOverlay').style.display='none'" style="background:transparent; border:none; color:var(--error-red); font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div id="contactListContainer" style="flex:1; overflow-y:auto; padding-top:10px;">
                <!-- List items injected here -->
            </div>
        </div>
    </div>

    <!-- HEADBAR -->
    <header class="headbar">
        <!-- Burger Menu (Inline SVG) -->
        <div id="toggleSidebar" style="cursor:pointer; padding: 10px;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="var(--accent-primary)">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
            </svg>
        </div>

        <div class="brand-title text-glow">ENTERPRISE ADMIN PANEL</div>

        <button class="lock-btn" id="lockBtn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>
            </svg>
            INTERFACE SPERREN
        </button>
    </header>

    <div class="app-container">
        <!-- SIDEBAR -->
        <nav class="sidebar" id="sidebar">
            <div class="nav-item active" onclick="switchModule('dashboard')">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                <span class="nav-text">Ãœbersicht</span>
            </div>
            <div class="nav-item" onclick="switchModule('inbox')">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                <span class="nav-text">Posteingang</span>
            </div>
            <div class="nav-item" onclick="switchModule('messenger')">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"/></svg>
                <span class="nav-text">Secure-Messenger</span>
            </div>
            <div class="nav-item" onclick="switchModule('users')">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                <span class="nav-text">Benutzerverwaltung</span>
            </div>
            <div class="nav-item" onclick="switchModule('audit')">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                <span class="nav-text">Audit-Protokolle</span>
            </div>
            <div class="nav-item" onclick="switchModule('settings')">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L5.09 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.04.24.24.41.48.41h3.84c.24 0 .43-.17.47-.41l.36-2.54c.59-.24 1.13-.57 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.08-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                <span class="nav-text">Einstellungen</span>
            </div>

            <div style="flex:1"></div>

            <div class="nav-item" id="logoutBtn" style="border-top: 1px solid #333;">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
                <span class="nav-text">Abmelden</span>
            </div>
        </nav>

        <!-- CONTENT -->
        <main class="content-area">

            <!-- 1. DASHBOARD -->
            <div id="dashboard" class="module active">
                <div class="dashboard-grid">
                    <!-- Stats -->
                    <div class="stat-card">
                        <div class="stat-label">Gesamt User</div>
                        <div class="stat-value" id="statUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Aktive Lizenzen</div>
                        <div class="stat-value" id="statLicenses">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Hub Status</div>
                        <div class="stat-value" style="color:#00ff88">ONLINE</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Letztes Backup</div>
                        <div class="stat-value" style="font-size:1.2rem; margin-top:10px" id="statBackup">--</div>
                    </div>

                    <!-- Globe -->
                    <div class="globe-container">
                        <div class="wireframe-globe">
                            <div class="globe-ring ring-1"></div>
                            <div class="globe-ring ring-2"></div>
                            <div class="globe-ring ring-3"></div>
                            <!-- Center Core -->
                            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:10px; height:10px; background:var(--accent-primary); border-radius:50%; box-shadow:0 0 20px var(--accent-primary);"></div>
                        </div>
                        <div style="position:absolute; bottom:10px; right:10px; color:var(--text-muted); font-size:0.7rem;">
                            GLOBAL HUB CONNECTION: ACTIVE
                        </div>
                    </div>

                    <!-- Console -->
                    <div class="console-container" id="liveConsole">
                        <div class="console-overlay"></div>
                        <div id="consoleOutput" style="margin-top: 20px;">
                            <!-- Logs go here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. USERS -->
            <div id="users" class="module">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2>Benutzerverwaltung</h2>
                    <button class="action-btn">Refresh</button>
                </div>
                <!-- Department Drag Board -->
                <div class="department-board" id="deptBoard">
                    <!-- Columns will be injected by JS -->
                </div>
            </div>

            <!-- 3. INBOX -->
            <div id="inbox" class="module">
                <h2>Support Posteingang</h2>
                <div class="stat-card" style="margin-top:20px; text-align:center;">
                    <p style="color:#888;">Keine neuen Support-Anfragen.</p>
                </div>
            </div>

            <!-- 4. MESSENGER -->
            <div id="messenger" class="module">
                <!-- SWITCH TOGGLE -->
                <div class="msg-toggle-container">
                    <button class="msg-toggle-btn active" id="toggleEncrypt" onclick="setMessengerMode('encrypt')">VERSCHLÃœSSELN</button>
                    <button class="msg-toggle-btn" id="toggleDecrypt" onclick="setMessengerMode('decrypt')">ENTSCHLÃœSSELN</button>
                </div>

                <div class="stat-card" style="min-height:500px;">

                    <!-- ENCRYPT MODE -->
                    <div id="modeEncrypt">
                        <div style="display:grid; grid-template-columns: 2fr 1fr; gap:30px;">
                            <!-- LEFT: INPUTS (70%) -->
                            <div>
                                <h3 class="text-accent" style="margin-bottom:20px;">NACHRICHT ERSTELLEN</h3>

                                <label style="display:block; margin-bottom:5px;">EMPFÃ„NGER (ID)</label>
                                <div style="display:flex; gap:10px; margin-bottom:20px;">
                                    <input type="text" id="msgRecipient" placeholder="z.B. user_123" style="flex:1; padding:12px;">
                                    <button onclick="toggleContacts()" style="padding:0 15px; background:#333; border:1px solid #444; color:#fff; cursor:pointer;">ðŸ“– KONTAKTE</button>
                                </div>

                                <label style="display:block; margin-bottom:5px;">5-STELLIGER CODE</label>
                                <input type="password" id="msgPasscode" maxlength="5" placeholder="12345" style="width:100px; margin-bottom:20px; padding:12px; letter-spacing:3px; text-align:center;">

                                <label style="display:block; margin-bottom:5px;">INHALT (TEXT)</label>
                                <textarea id="msgPayload" rows="8" style="width:100%; background:#000; color:#fff; border:1px solid #444; padding:15px; margin-bottom:20px; font-size:1rem; box-sizing:border-box;"></textarea>

                                <!-- File Upload Zone -->
                                <div id="dropZone" style="border:2px dashed #333; padding:30px; text-align:center; color:#888; margin-bottom:20px; cursor:pointer; transition:0.3s;" onclick="document.getElementById('fileInput').click()">
                                    <div style="font-size:2rem; margin-bottom:10px;">ðŸ“Ž</div>
                                    <span>Datei hier ablegen oder klicken (Max 5MB)</span>
                                    <input type="file" id="fileInput" style="display:none">
                                    <div id="fileInfo" style="color:var(--accent-primary); font-size:0.9rem; margin-top:10px;"></div>
                                </div>
                            </div>

                            <!-- RIGHT: CONTROLS & STATUS (30%) -->
                            <div style="display:flex; flex-direction:column; gap:15px;">
                                <h3 class="text-accent" style="margin-bottom:20px;">AKTIONEN</h3>

                                <button class="action-btn" id="btnEncrypt" style="padding:15px; font-size:1.1rem; width:100%;">ðŸ”’ VERSCHLÃœSSELN</button>

                                <div style="height:1px; background:#333; margin:10px 0;"></div>

                                <button class="action-btn" id="btnCopy" style="background:#222; color:#ccc; width:100%;">KOPIEREN (CLIPBOARD)</button>
                                <button class="action-btn" id="btnDownload" style="background:#222; color:#ccc; width:100%;">DOWNLOAD .TXT</button>
                                <button class="action-btn" id="btnSend" style="background:var(--success-green); color:#000; font-weight:900; width:100%;">ðŸ“¡ VERSENDEN (BEAM)</button>

                                <div style="height:1px; background:#333; margin:10px 0;"></div>

                                <button class="action-btn" id="btnClear" style="background:rgba(255,50,50,0.2); color:var(--error-red); width:100%;">ALLES LEEREN</button>

                                <div id="msgStatus" style="margin-top:20px; padding:15px; background:#000; border:1px solid #333; min-height:40px; font-family:'Roboto Mono'; font-size:0.9rem;">
                                    Bereit.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DECRYPT MODE -->
                    <div id="modeDecrypt" style="display:none;">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px;">
                            <!-- LEFT: INPUT -->
                            <div>
                                <h3 class="text-accent" style="margin-bottom:20px;">ENTSCHLÃœSSELUNG</h3>

                                <label style="display:block; margin-bottom:5px;">5-STELLIGER CODE</label>
                                <input type="password" id="decPasscode" maxlength="5" placeholder="12345" style="width:100px; margin-bottom:20px; padding:12px; letter-spacing:3px; text-align:center;">

                                <label style="display:block; margin-bottom:5px;">CIPHER-TEXT (EINFÃœGEN)</label>
                                <textarea id="decInput" rows="12" placeholder="VerschlÃ¼sselten Text hier einfÃ¼gen..." style="width:100%; background:#000; color:var(--accent-primary); border:1px solid #444; padding:15px; margin-bottom:20px; font-family:'Roboto Mono'; font-size:0.9rem;"></textarea>

                                <div style="display:flex; gap:10px;">
                                    <button class="action-btn" id="btnDecrypt" style="flex:2; padding:15px;">ðŸ”“ ENTSCHLÃœSSELN</button>
                                    <button class="action-btn" id="btnDecClear" style="background:#222; color:#aaa;">LEEREN</button>
                                </div>
                            </div>

                            <!-- RIGHT: OUTPUT -->
                            <div>
                                <h3 class="text-accent" style="margin-bottom:20px;">ERGEBNIS</h3>
                                <div id="decOutput" style="background:#000; border:1px solid #444; height:400px; padding:20px; overflow-y:auto; font-family:'Roboto Mono'; color:#fff;">
                                    <span style="color:#666;">Warte auf Eingabe...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- 5. AUDIT -->
            <div id="audit" class="module">
                <h2>System Audit Logs</h2>
                <div style="margin-top:20px; max-height: 80vh; overflow-y:auto;">
                    <table class="data-table">
                        <thead>
                            <tr><th>Time</th><th>Action</th><th>User/IP</th><th>Details</th></tr>
                        </thead>
                        <tbody id="auditTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- 6. SETTINGS -->
            <div id="settings" class="module">
                <h2>Einstellungen</h2>
                <div class="stat-card" style="margin-top:20px;">
                     <h3>Hybrid Key Supplement</h3>
                     <p style="color:#888; font-size:0.8rem;">Teilen Sie diesen Key nur mit vertrauenswÃ¼rdigen Partnern.</p>
                     <input type="text" id="settingSupplement" readonly style="width:100%; color:var(--accent-primary); border:none; background:transparent; font-size:1.2rem; letter-spacing:2px;">
                </div>
            </div>

        </main>
    </div>

    <script src="/cryptoLayers.js"></script>
    <script src="/assets/js/portal.js"></script>
</body>
</html>
